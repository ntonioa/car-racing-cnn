\tikzstyle{input_block} = [rectangle, draw, fill=gray!20, align=center, rounded corners, minimum height=0.6cm, font=\small]
\tikzstyle{conv_block1} = [rectangle, draw, fill=blue!20, text centered, rounded corners, text width=4.5cm, minimum height=0.6cm, font=\small]
\tikzstyle{conv_block2} = [rectangle, draw, fill=blue!20, text centered, rounded corners, text width=3.9cm, minimum height=0.6cm, font=\small]
\tikzstyle{dense_block} = [rectangle, draw, fill=orange!20, text centered, rounded corners, minimum height=0.6cm, font=\small]
\tikzstyle{dropout_block} = [rectangle, draw, fill=red!20, text centered, rounded corners, minimum height=0.6cm, font=\small]
\tikzstyle{activation_block} = [rectangle, draw, fill=green!20, text centered, rounded corners, minimum height=0.6cm, font=\small]
\tikzstyle{pooling_block} = [rectangle, draw, fill=purple!20, text centered, rounded corners, minimum height=0.6cm, font=\small]
\tikzstyle{flatten_block} = [rectangle, draw, fill=yellow!20, text centered, rounded corners, minimum height=0.6cm, font=\small]

\tikzstyle{arrow} = [thick,->,>=stealth]

\begin{figure}[htbp]
    \centering
    \subfloat[Structure of model 0.]{
        \begin{tikzpicture}[node distance=1cm]
            % Input
            \node (input) [input_block] {\textbf{Input}: shape=(96, 96, 1)};
            
            % Conv1
            \node (conv1) [conv_block1, below=0.8cm of input] {\textbf{Conv2D}: filters=8, kernel=7, strides=3, L2 
                penalty=0.001};
            \node (act1) [activation_block, below=0.3cm of conv1] {\textbf{Activation}: ReLU};
            \node (pool1) [pooling_block, below=0.3cm of act1] {\textbf{MaxPooling2D}: pool size=2, strides=2};
            
            % Conv2
            \node (conv2) [conv_block2, below=0.8cm of pool1] {\textbf{Conv2D}: filters=16, kernel=4, L2 penalty=0.001};
            \node (act2) [activation_block, below=0.3cm of conv2] {\textbf{Activation}: ReLU};
            \node (pool2) [pooling_block, below=0.3cm of act2] {\textbf{MaxPooling2D}: pool size=2, strides=2};
            
            % Flatten
            \node (flatten) [flatten_block, below=0.8cm of pool2] {\textbf{Flatten}};
            
            % Dense1
            \node (dense1) [dense_block, below=0.8cm of flatten] {\textbf{Dense}: units=128, L2 penalty=0.001};
            \node (drop1) [dropout_block, below=0.3cm of dense1] {\textbf{Dropout}: rate=0.4};
            \node (act3) [activation_block, below=0.3cm of drop1] {\textbf{Activation}: ReLU};
            
            % Dense2
            \node (dense2) [dense_block, below=0.8cm of act3] {\textbf{Dense}: units=64, L2 penalty=0.001};
            \node (drop2) [dropout_block, below=0.3cm of dense2] {\textbf{Dropout}: rate=0.3};
            \node (act4) [activation_block, below=0.3cm of drop2] {\textbf{Activation}: ReLU};
            
            % Output
            \node (dense3) [dense_block, below=0.8cm of act4] {\textbf{Dense}: units=5};
            \node (act5) [activation_block, below=0.3cm of dense3] {\textbf{Activation}: softmax};
            
            % Arrows
            \draw [arrow] (input) -- node[right] {(96, 96, 1)} (conv1);
            
            \draw [arrow] (conv1) -- (act1);
            \draw [arrow] (act1) -- (pool1);
            \draw [arrow] (pool1) -- node[right] {(15, 15, 8)} (conv2);
            
            \draw [arrow] (conv2) -- (act2);
            \draw [arrow] (act2) -- (pool2);
            \draw [arrow] (pool2) -- node[right] {(6, 6, 16)} (flatten);
            
            \draw [arrow] (flatten) -- node[right] {(576)} (dense1);

            \draw [arrow] (dense1) -- (drop1);
            \draw [arrow] (drop1) -- (act3);
            \draw [arrow] (act3) -- node[right] {(128)} (dense2);
            
            \draw [arrow] (dense2) -- (drop2);
            \draw [arrow] (drop2) -- (act4);
            \draw [arrow] (act4) -- node[right] {(64)} (dense3);
            
            \draw [arrow] (dense3) -- (act5);
            
        \end{tikzpicture}
    }
    \hspace{0.5cm}
    \subfloat[Structure of model 1.]{
        \begin{tikzpicture}[node distance=1cm]
            % Input
            \node (input) [input_block] {\textbf{Input}: shape=(96, 96, 1)};
            
            % Conv1
            \node (conv1) [conv_block1, below=0.8cm of input] {\textbf{Conv2D}: filters=6, kernel=3, strides=2, L2 penalty=0.001};
            \node (act1) [activation_block, below=0.3cm of conv1] {\textbf{Activation}: ReLU};
            \node (pool1) [pooling_block, below=0.3cm of act1] {\textbf{MaxPooling2D}: pool size=3, strides=3};
            
            % Conv2
            \node (conv2) [conv_block2, below=0.8cm of pool1] {\textbf{Conv2D}: filters=12, kernel=5, L2 penalty=0.001};
            \node (act2) [activation_block, below=0.3cm of conv2] {\textbf{Activation}: ReLU};
            \node (pool2) [pooling_block, below=0.3cm of act2] {\textbf{MaxPooling2D}: pool size=2, strides=2};
            
            % Flatten
            \node (flatten) [flatten_block, below=0.8cm of pool2] {\textbf{Flatten}};
            
            % Dense1
            \node (dense1) [dense_block, below=0.8cm of flatten] {\textbf{Dense}: units=256, L2 penalty=0.001};
            \node (drop1) [dropout_block, below=0.3cm of dense1] {\textbf{Dropout}: rate=0.4};
            \node (act3) [activation_block, below=0.3cm of drop1] {\textbf{Activation}: ReLU};
            
            % Dense2
            \node (dense2) [dense_block, below=0.8cm of act3] {\textbf{Dense}: units=5};
            \node (act4) [activation_block, below=0.3cm of dense2] {\textbf{Activation}: softmax};
            
            % Arrows
            \draw [arrow] (input) -- node[right] {(96, 96, 1)} (conv1);
            
            \draw [arrow] (conv1) -- (act1);
            \draw [arrow] (act1) -- (pool1);
            \draw [arrow] (pool1) -- node[right] {(15, 15, 6)} (conv2);

            \draw [arrow] (conv2) -- (act2);
            \draw [arrow] (act2) -- (pool2);
            \draw (pool2) -- node[right] {(5, 5, 12)} (flatten);
            
            \draw [arrow] (flatten) -- node[right] {(300)} (dense1);

            \draw [arrow] (dense1) -- (drop1);
            \draw [arrow] (drop1) -- (act3);
            \draw [arrow] (act3) -- node[right] {(256)} (dense2);

            \draw [arrow] (dense2) -- (act4);
        \end{tikzpicture}
    }
    \caption{Comparison of CNN structures. The padding is always \textit{valid}, and where not specified the strides are set to 1.}
    \label{fig:model_structures}
\end{figure}
